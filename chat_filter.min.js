!function(e){"use strict";var t=document.createElement("script");t.appendChild(document.createTextNode("("+e.toString()+"());")),document.body.appendChild(t)}(function(){"use strict";function e(e,t){for(var n=0;n<e.length;n++)t(e[n],n,e)}function t(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function n(e,t){for(var n=0;n<e.length;n++)if(!t(e[n]))return!1;return!0}function a(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function r(e,t){return e=e.toLowerCase(),e.indexOf(t.toLowerCase())>=0}function o(e){M.push(e)}function i(){e(M,function(e){e()})}function s(t){e(z,function(e){if(!(e in t))throw new Error("Missing param "+e)}),a(t,function(e){if(z.indexOf(e)<0&&H.indexOf(e)<0)throw new Error("Unexpected param "+e)});var n=this;a(t,function(e,t){n[e]=t}),this._value=null,this._observers=[]}function l(e){var t=new s(e);j.push(t),L[t.name]=t,t.message_filter&&W.push(t),t.message_css&&P.push(t),t.message_rewriter&&q.push(t)}function c(e){return L[e].getValue()}function u(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null}function m(e,t){localStorage.setItem(e,JSON.stringify(t))}function f(){var e;e=window.localStorage?u(U):{},a(L,function(t,n){n.setValue(t in e?e[t]:null)})}function d(){if(window.localStorage){var e={};a(L,function(t,n){null!==n._value&&(e[t]=n._value)}),m(U,e)}}function p(e){$("head").append("<style>"+e.join("")+"</style>")}function g(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,a,r=[];for(n=0;n<=t.length;n++)r[n]=[n];for(a=0;a<=e.length;a++)r[0][a]=a;for(n=1;n<=t.length;n++)for(a=1;a<=e.length;a++)r[n][a]=t.charAt(n-1)===e.charAt(a-1)?r[n-1][a-1]:1+Math.min(r[n-1][a-1],r[n][a-1],r[n-1][a]);return r[t.length][e.length]}function h(e){return t(Q,function(t){return g(t.toLowerCase(),e.toLowerCase())<=Z})}function v(e){return/^([0-9]+),([0-9]+)$/.test(e.replace(/\s/g,""))?!0:n(e.split(/\s+/),function(e){if(e.length<=0)return!0;var t=e.match(/(?:([a-z]+)[^a-z]{0,2})+/gi);return t&&n(t,function(e){var t=e.match(/[a-z]+/gi);return n(t,h)})})}function y(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);a>=9600&&9632>=a&&t++}return t>3}function w(e){return/[\u0400-\u04FF]/.test(e)}function b(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);et.indexOf(a)>=0&&t++}return t>1}function _(e){return e.split(/\s/g).length<=1}function C(e){return e.length>=200}function x(e){return e.replace(/(.{4}.*?)(\s*?\1)+/g,"$1")}function T(e){return e.replace(/[\u0300-\u036F]/g,"")}function V(t){var n=t;return e(tt,function(e){n=n.replace(e,"")}),/^\s*$/.test(n)}function k(e){var n=c("TppBanCustomWords"),a=c("TppBannedWords");return n&&t(a,function(t){return r(e,t)})}function N(t,n){var a={};return t=t||"",n=n||"",e(W,function(e){a[e.name]=e.message_filter(t,n)}),a}function O(e){var t=Date.now();it=t,lt=st,st={text:e,time:t}}function S(){st=lt,lt=null}function A(e){var t;if(/now in slow mode/.test(e)&&(t=/(\d+) second/.exec(e))){if(rt==Number(t[1]))return!1;rt=Number(t[1])}if(/identical to the previous/.test(e)&&(t=/than (\d+) second/.exec(e),t&&(ot=Number(t[1])),S()),/you are sending messages too quickly/.test(e)){if(t=/in (\d+) second/.exec(e)){var n=Number(t[1]),a=Date.now()-st.time+1e3*n;rt=Math.ceil(a/1e3)}S()}if(/You are banned/.test(e)){if(t=/for (\d+) more second/.exec(e)){var r=Number(t[1]);ct=Date.now()+1e3*r}S()}return E(),!0}function D(e){var t=Date.now();if(ct){var n=ct-t;if(n>0)return{blocked:!0,error:"you are banned",wait:n}}if(st){var a=it+at-t;if(a>0)return{blocked:!0,error:"",wait:null};if(e===st.text){var r=st.time+1e3*ot-t;if(r>0)return{blocked:!0,error:"repeated message",wait:r}}var o=st.time+1e3*rt-t;if(o>0)return{blocked:!0,error:"slowmode",wait:o}}return{blocked:!1}}function E(){var e=$(G).val(),t=D(e),n=$(K);if(c("TppSlowmodeHelper")&&t.blocked){var a;a=t.error?"Wait "+Math.ceil(t.wait/1e3)+" seconds ("+t.error+")":"...",n.addClass(mt),n.text(a),dt=!1}else dt||(n.removeClass(mt),n.text(ft),dt=!0)}function F(){i(),f(),console.log(B)}if(window.$){var I="3.3",B="TIAL Chat Filter version "+I+" loaded. Please report bugs and suggestions to https://github.com/wallisk/twitch-chat-filter",M=[],z=["name","comment","category","defaultValue"],H=["longComment","message_filter","message_css","message_rewriter"];s.prototype.getValue=function(){return null!==this._value?this._value:this.defaultValue},s.prototype.setValue=function(t){var n=this.getValue();this._value=t;var a=this.getValue();e(this._observers,function(e){e(a,n)})},s.prototype.reset=function(){this.setValue(null)},s.prototype.observe=function(e){this._observers.push(e)},s.prototype.forceObserverUpdate=function(){var t=this.getValue();e(this._observers,function(e){e(t,t)})};var j=[],L={},W=[],q=[],P=[],U="tial-chat-filter-settings";o(function(){e(j,function(e){e.observe(function(){d()})})});var R=".chat-room",J=".message",X=".from",Y=".chat-line",G=".chat-interface textarea",K="button.send-chat-button",Q=["-","minus","a","A","b","B","c","C","d","D","e","E","f","F","g","G","h","H","i","I","j","J","k","K","l","L","m","M","n","N","o","O","p","P","q","Q","r","R","s","S","t","T","u","U","v","V","w","W","x","X","y","Y","z","Z","0","1","2","3","4","5","6","7","8","9","!","at","#","$","%","^","&","*","(",")","-","_","'",'"',"dot",":",";","=",">","<","`","~","slash","?","backslash","[","]","{","}","escape","backspace","enter","space","tab","up","down","left","right","f1","f2","f3","f4","f5","f6","f7","f8","f9","alt-f1","alt-f2","alt-f3","alt-f4","alt-f5","alt-f6","alt-f7","alt-f8","alt-f9","ctrl-a","ctrl-b","ctrl-c","ctrl-d","ctrl-e","ctrl-f","ctrl-g","ctrl-h","ctrl-i","ctrl-j","ctrl-k","ctrl-l","ctrl-m","ctrl-n","ctrl-o","ctrl-p","ctrl-q","ctrl-r","ctrl-s","ctrl-t","ctrl-u","ctrl-v","ctrl-w","ctrl-x","ctrl-y","ctrl-z","nop","system_reset","boot_cd","boot_drive","yes","rm -rf /"],Z=2;l({name:"TppFilterCommand",comment:"Emulator commands",longComment:Q.join(", "),category:"filters_category",defaultValue:!0,message_filter:v}),l({name:"TppFilterAscii",comment:"Blocky drawings",longComment:"Stuff like this: ░░░░▒▒▒▒▌ ▀▒▀▐▄█",category:"filters_category",defaultValue:!0,message_filter:y}),l({name:"TppFilterCyrillic",comment:"Cyrillic",longComment:"Cyrillic characters in copypastas confuse our other filters",category:"filters_category",defaultValue:!0,message_filter:w});var et=[3720,9685,664,8362,3232,176,8248,8226,7886,3237];l({name:"TppFilterDonger",comment:"Dongers",longComment:"ヽ༼ຈل͜ຈ༽ﾉ",category:"filters_category",defaultValue:!1,message_filter:b}),l({name:"TppFilterSmall",comment:"One-word messages",category:"filters_category",defaultValue:!1,message_filter:_}),l({name:"TppFilterLong",comment:"Overly long messages",longComment:"Hide messages over 200 characters (around 4 lines)",category:"filters_category",defaultValue:!1,message_filter:C}),l({name:"TppRewriteDuplicates",comment:"Copy pasted repetitions",category:"rewriters_category",defaultValue:!0,message_rewriter:x}),l({name:"TppMopUpDrinks",comment:"Mop up spilled drinks",category:"rewriters_category",defaultValue:!0,message_rewriter:T}),l({name:"TppConvertAllcaps",comment:"Lowercase everything",longComment:null,category:"visual_category",defaultValue:!0,message_css:J+"{text-transform:lowercase !important;}"});var tt=[];o(function(){Twitch&&Twitch.api.get("chat/emoticons").then(function(t){e(t.emoticons,function(e){var t=e.regex;t.match(/^\w+$/)&&(t="\\b"+t+"\\b"),tt.push(new RegExp(t,"g"))})})}),l({name:"TppHideEmoticons",comment:"Hide emoticons",category:"visual_category",defaultValue:!1,message_css:J+" .emoticon{display:none !important;}",message_filter:V}),l({name:"TppNoColor",comment:"Uncolor messages",longComment:"Remove color from messages created with the /me command",category:"visual_category",defaultValue:!1,message_css:J+" {color:inherit !important;}"}),l({name:"TppBanCustomWords",comment:"Activate custom banlist",longComment:"",category:"customs_category",defaultValue:!1,message_css:"#menu-TppBannedWords { display:inherit; }"}),o(function(){p(["#menu-TppBannedWords { display:none; }"])}),l({name:"TppBannedWords",comment:"Banned Phrases",longComment:"If the custom banlist is activated, these messages will be hidden",category:"customs_category",defaultValue:[],message_filter:k});var nt=".chat-settings";o(function(){function t(){var e=s.height();e>0&&i.css("max-height",.9*e)}function n(e,t){e.append($("<label>").attr("for",t.name).attr("title",t.longComment||"").append($('<input type="checkbox">').attr("id",t.name)).append(document.createTextNode(" "+t.comment)));var n=$("#"+t.name);n.on("change",function(){t.setValue($(this).prop("checked"))}),t.observe(function(e){n.prop("checked",e)})}function a(t,n){function a(e){var t=n.getValue().slice();t.indexOf(e)<0&&(t.push(e),n.setValue(t))}function r(e){var t=n.getValue().slice();t.splice(e,1),n.setValue(t)}function o(){$("#show-"+n.name).show(),$("#hide-"+n.name).hide(),$("#clear-"+n.name).hide(),$("#list-"+n.name).hide()}function i(){$("#show-"+n.name).hide(),$("#hide-"+n.name).show(),$("#clear-"+n.name).show(),$("#list-"+n.name).show()}t.append($("<label>").attr("for",n.name).attr("title",n.longComment||"").append(document.createTextNode("Add "+n.comment)).append($('<input type="text">').attr("id",n.name).css("width","100%"))).append($("<button>").attr("id","show-"+n.name).append(document.createTextNode("Show ")).append($("<span>").attr("id","num-banned-"+n.name)).append(document.createTextNode(" "+n.comment))).append($("<button>").attr("id","hide-"+n.name).append(document.createTextNode("Hide "+n.comment))).append($('<div class="custom_list_menu">').attr("id","list-"+n.name)).append($("<button>").attr("id","clear-"+n.name).append(document.createTextNode("Clear "+n.comment))),o(),n.observe(function(t){$("#num-banned-"+n.name).text(t.length);var a=$("#list-"+n.name);a.empty(),e(t,function(e,t){a.append($("<li>").text(e).append($('<a href="#">').text("[X]").click(function(){r(t)})))})}),$("#"+n.name).keyup(function(e){var t=$(this).val().trim();13===e.keyCode&&""!==t&&(a(t),$(this).val(""))}),$("#show-"+n.name).click(function(e){e.preventDefault(),i()}),$("#hide-"+n.name).click(function(e){e.preventDefault(),o()}),$("#clear-"+n.name).click(function(e){e.preventDefault(),n.setValue([])})}function r(e){$('<div class="list-header"/>').text(e).appendTo(i);var t=$('<div class="chat-menu-content">').appendTo(i);return t}function o(t,r){e(j,function(e){if(e.category===r){var o=$("<p>").attr("id","menu-"+e.name).addClass("dropmenu_action").appendTo(t),i=typeof e.defaultValue;if("boolean"===i)n(o,e);else{if("object"!==i)throw new Error("Unrecognized setting "+i);a(o,e)}}})}p([".chat-room { z-index: inherit !important; }",".chat-settings { z-index: 100 !important; }",".custom_list_menu li {background: #bbb; display: block; list-style: none; margin: 1px 0; padding: 0 2px}",".custom_list_menu li a {float: right;}"]);var i=$(nt),s=$(R);i.css("overflow-y","auto"),t(),setInterval(t,500),$(window).resize(t);var l=r("Hide");o(l,"filters_category");var c=r("Automatically rewrite");o(c,"rewriters_category");var u=r("Visual tweaks");o(u,"visual_category");var m=r("Custom Banlist");o(m,"customs_category");var f=r("Misc");f.append($("<button>Reset TPP filter settings</a>").click(function(){confirm("This will reset all Twitch Chat Filter settings to their default values and will delete all custom banned phrases. Are you sure you want to continue?")&&e(j,function(e){e.reset()})}))}),o(function(){var t=[];e(P,function(e){t.push(R+"."+e.name+" "+e.message_css)}),p(t),e(P,function(e){e.observe(function(t){$(R).toggleClass(e.name,t)})})}),o(function(){var t=[];e(W,function(e){var n=e.name,a=e.name+"Hidden";t.push(R+"."+a+" "+Y+"."+n+"{display:none}"),e.observe(function(){$(R).toggleClass(a,e.getValue())})}),p(t)}),o(function(){var t=require("web-client/components/chat-line")["default"].prototype,n=t.didInsertElement;t.didInsertElement=function(){n.apply(this,arguments);var e=this.$(),t=N(this.get("msgObject.message"),this.get("msgObject.from"));for(var a in t)e.toggleClass(a,t[a])},$(Y).each(function(){var t=$(this),n=t.find(J).text().trim(),a=t.find(X).text().trim();e(W,function(e){t.toggleClass(e.name,e.message_filter(n,a))})})});var at=1e3,rt=2,ot=30,it=null,st=null,lt=null,ct=null,ut=500,mt="tpp-slowmode-warning",ft=null,dt=!0;if(o(function(){ft=$(K).text(),p(["."+mt+"{ opacity:0.7 !important}"]),$(G).keyup(function(e){13!==e.keyCode&&E()}),setInterval(function(){E()},ut)}),l({name:"TppSlowmodeHelper",comment:"Slowmode helper",longComment:"Shows a countdown of how long you need to wait until being able to chat again",category:"visual_category",defaultValue:!0}),o(function(){var e=require("web-client/models/room")["default"].prototype,t=e.addMessage;e.addMessage=function(e){return"admin"!==e.style||A(e.message)?t.apply(this,arguments):!1};var n=e.send;e.send=function(e){return O(e),n.apply(this,arguments)}}),$(nt).length)F();else{var pt=require("web-client/views/chat")["default"].prototype,gt=pt.didInsertElement;pt.didInsertElement=function(){gt&&gt.apply(this,arguments),F()}}}});